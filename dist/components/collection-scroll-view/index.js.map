{"version":3,"file":"index.js","sources":["../../../src/components/collection-scroll-view/index.js"],"sourcesContent":["import { scheduleOnce } from '@ember/runloop';\nimport { service } from '@ember/service';\nimport Component from '@glimmer/component';\nimport { cached, tracked } from '@glimmer/tracking';\nimport { modifier } from 'ember-modifier';\n\nconst MAX_PENDING_RESTORE_ATTEMPTS = 5;\n\nexport default class CollectionScrollView extends Component {\n  @service('scroll-position-memory') memory;\n\n  @tracked clientWidth;\n  @tracked clientHeight;\n  @tracked scrollTop = 0;\n  scrollElement;\n  _didRequestInitialRestore = false;\n  _restoreRafId = null;\n\n  get headerHeight() {\n    return this.args.headerHeight || 0;\n  }\n\n  @cached\n  get measuredClientSize() {\n    if (this.clientWidth && this.clientHeight) {\n      return {\n        width: this.clientWidth,\n        height: this.clientHeight,\n      };\n    }\n    return null;\n  }\n\n  get clientSize() {\n    return (\n      this.measuredClientSize || {\n        width: this.args.estimatedWidth,\n        height: this.args.estimatedHeight,\n      }\n    );\n  }\n\n  get collectionClientSize() {\n    let { clientSize, headerHeight, scrollTop } = this;\n    let result = {\n      width: clientSize.width,\n      height: clientSize.height - Math.max(headerHeight - scrollTop, 0),\n    };\n    return result;\n  }\n\n  maybeRequestInitialRestore() {\n    if (this._didRequestInitialRestore) {\n      return;\n    }\n    if (this.args.isLoading) {\n      return;\n    }\n    if (!this._hasInitialVisibleChange) {\n      return;\n    }\n    this._didRequestInitialRestore = true;\n    this.restoreScrollPosition();\n  }\n\n  firstVisibleChanged = (firstVisibleItem) => {\n    this.args.firstVisibleChanged?.(firstVisibleItem);\n\n    if (!this._hasInitialVisibleChange) {\n      this._hasInitialVisibleChange = true;\n    }\n    this.maybeRequestInitialRestore();\n  };\n\n  get visibleHeaderHeight() {\n    let { headerHeight, scrollTop } = this;\n    return Math.max(0, headerHeight - scrollTop);\n  }\n\n  get windowRef() {\n    return window;\n  }\n\n  registerScrollElement = modifier((element) => {\n    this.scrollElement = element;\n    this.scrollTop = element?.scrollTop ?? 0;\n    this.clientWidth = element?.clientWidth ?? 0;\n    this.clientHeight = element?.clientHeight ?? 0;\n\n    this.args.scrolledToTopChange?.(this.scrollTop === 0);\n\n    return () => {\n      if (this.scrollElement === element) {\n        this.scrollElement = null;\n      }\n      this.clientWidth = undefined;\n      this.clientHeight = undefined;\n      this.scrollTop = 0;\n    };\n  });\n\n  watchIsLoading = modifier((_element, [isLoading]) => {\n    if (!isLoading) {\n      this.maybeRequestInitialRestore();\n    }\n  });\n\n  willDestroy() {\n    super.willDestroy(...arguments);\n    if (this._restoreRafId) {\n      cancelAnimationFrame(this._restoreRafId);\n      this._restoreRafId = null;\n    }\n    this.scrollElement = null;\n  }\n\n  get isInViewport() {\n    if (!this.scrollElement) {\n      return false;\n    }\n    let rect = this.scrollElement.getBoundingClientRect();\n    let viewportHeight =\n      window.innerHeight || document.documentElement.clientHeight;\n    let viewportWidth =\n      window.innerWidth || document.documentElement.clientWidth;\n    return (\n      rect.top >= 0 &&\n      rect.left >= 0 &&\n      rect.bottom <= viewportHeight &&\n      rect.right <= viewportWidth\n    );\n  }\n\n  registerAPI = (verticalCollectionApi) => {\n    this.verticalCollectionApi = verticalCollectionApi;\n  };\n\n  handleScroll = (event) => {\n    let nextScrollTop = event?.target?.scrollTop ?? 0;\n\n    if (nextScrollTop !== this.scrollTop) {\n      this.scrollTop = nextScrollTop;\n    }\n    this.args.scrolledToTopChange?.(nextScrollTop === 0);\n\n    this.storeScrollPosition();\n  };\n\n  scrollToTopIfInViewport = () => {\n    if (this.isInViewport) {\n      this.scrollToTop();\n    }\n  };\n\n  scrollToTop() {\n    this.scrollTo(0);\n  }\n\n  scrollTo(yPos) {\n    let element = this.scrollElement;\n    if (!element) {\n      return;\n    }\n    try {\n      element.scrollTo({\n        top: yPos,\n        behavior: 'smooth',\n      });\n    } catch (e) {\n      element.scrollTop = yPos;\n    }\n  }\n\n  scrollToItem = async (revealItemPayload) => {\n    let { id, source } = revealItemPayload;\n    if (\n      source &&\n      (isChildComponent(this, source) ||\n        isChildElement(this.scrollElement, source))\n    ) {\n      return;\n    }\n\n    await this.verticalCollectionApi?.scrollToItem(id);\n  };\n\n  handleResize = (entry) => {\n    let rect = entry?.contentRect;\n    let width;\n    let height;\n\n    if (rect) {\n      ({ width, height } = rect);\n    } else if (this.scrollElement) {\n      width = this.scrollElement.clientWidth;\n      height = this.scrollElement.clientHeight;\n    }\n\n    if (width !== undefined) {\n      this.clientWidth = width;\n    }\n\n    let previousHeight = this.clientHeight;\n    if (height !== undefined) {\n      this.clientHeight = height;\n    }\n\n    if (height !== undefined && height !== previousHeight) {\n      this.scheduleVerticalCollectionRefresh();\n    }\n\n    this.schedulePendingRestore();\n  };\n\n  scheduleVerticalCollectionRefresh() {\n    if (this._verticalCollectionRefreshScheduled) {\n      return;\n    }\n    this._verticalCollectionRefreshScheduled = true;\n    scheduleOnce('afterRender', this, this.dispatchVerticalCollectionRefresh);\n  }\n\n  dispatchVerticalCollectionRefresh() {\n    this._verticalCollectionRefreshScheduled = false;\n    if (typeof window === 'undefined') {\n      return;\n    }\n    window.dispatchEvent(new Event('resize'));\n  }\n\n  storeScrollPosition() {\n    if (!this.args.memoryScrollKey || !this.scrollElement) {\n      return;\n    }\n    let scrollTop = this.scrollElement.scrollTop ?? 0;\n    this.memory[this.args.memoryScrollKey] = scrollTop;\n  }\n\n  restoreScrollPosition() {\n    const { initialScrollTop, memoryScrollKey } = this.args;\n    if (!memoryScrollKey && !initialScrollTop) {\n      return;\n    }\n    let storedPosition = this.memory[memoryScrollKey];\n    if (typeof storedPosition !== 'number') {\n      storedPosition = initialScrollTop;\n    }\n    if (typeof storedPosition !== 'number') {\n      return;\n    }\n    this._pendingRestorePosition = storedPosition;\n    this._pendingRestoreAttempts = 0;\n    this.schedulePendingRestore();\n  }\n\n  schedulePendingRestore() {\n    const hasReachedMaxAttempts =\n      this._pendingRestoreAttempts >= MAX_PENDING_RESTORE_ATTEMPTS;\n\n    if (\n      hasReachedMaxAttempts ||\n      this._pendingRestorePosition === undefined ||\n      this._restoreScheduled\n    ) {\n      if (hasReachedMaxAttempts) {\n        this._pendingRestorePosition = undefined;\n      }\n      return;\n    }\n    this._pendingRestoreAttempts = (this._pendingRestoreAttempts ?? 0) + 1;\n    this._restoreScheduled = true;\n    this._restoreRafId = requestAnimationFrame(() => {\n      this._restoreRafId = null;\n      this.applyPendingRestore();\n    });\n  }\n\n  applyPendingRestore() {\n    this._restoreScheduled = false;\n    let position = this._pendingRestorePosition;\n    if (position === undefined) {\n      return;\n    }\n    if (!this.canRestoreScrollPosition()) {\n      this.schedulePendingRestore();\n      return;\n    }\n    let targetScrollTop = Math.max(0, position);\n    this.scrollElement.scrollTop = targetScrollTop;\n    this.scrollTop = targetScrollTop;\n    try {\n      this.scrollElement.dispatchEvent(new Event('scroll'));\n    } catch (e) {\n      // ignore\n    }\n    this._pendingRestorePosition = undefined;\n    this._pendingRestoreAttempts = 0;\n  }\n\n  canRestoreScrollPosition() {\n    return (\n      Boolean(this.scrollElement) && Boolean(this._hasInitialVisibleChange)\n    );\n  }\n}\n\nfunction isChildComponent(component, candidateChildComponent) {\n  let parentView = candidateChildComponent;\n  while ((parentView = parentView.parentView)) {\n    if (parentView === component) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isChildElement(element, candidateChildElement) {\n  return (\n    element &&\n    candidateChildElement instanceof HTMLElement &&\n    element.contains(candidateChildElement)\n  );\n}\n"],"names":["MAX_PENDING_RESTORE_ATTEMPTS","CollectionScrollView","Component","g","prototype","service","i","void 0","tracked","scrollElement","_didRequestInitialRestore","_restoreRafId","headerHeight","args","measuredClientSize","clientWidth","clientHeight","width","height","n","cached","clientSize","estimatedWidth","estimatedHeight","collectionClientSize","scrollTop","result","Math","max","maybeRequestInitialRestore","isLoading","_hasInitialVisibleChange","restoreScrollPosition","firstVisibleChanged","firstVisibleItem","visibleHeaderHeight","windowRef","window","registerScrollElement","modifier","element","scrolledToTopChange","undefined","watchIsLoading","_element","willDestroy","arguments","cancelAnimationFrame","isInViewport","rect","getBoundingClientRect","viewportHeight","innerHeight","document","documentElement","viewportWidth","innerWidth","top","left","bottom","right","registerAPI","verticalCollectionApi","handleScroll","event","nextScrollTop","target","storeScrollPosition","scrollToTopIfInViewport","scrollToTop","scrollTo","yPos","behavior","e","scrollToItem","revealItemPayload","id","source","isChildComponent","isChildElement","handleResize","entry","contentRect","previousHeight","scheduleVerticalCollectionRefresh","schedulePendingRestore","_verticalCollectionRefreshScheduled","scheduleOnce","dispatchVerticalCollectionRefresh","dispatchEvent","Event","memoryScrollKey","memory","initialScrollTop","storedPosition","_pendingRestorePosition","_pendingRestoreAttempts","hasReachedMaxAttempts","_restoreScheduled","requestAnimationFrame","applyPendingRestore","position","canRestoreScrollPosition","targetScrollTop","Boolean","component","candidateChildComponent","parentView","candidateChildElement","HTMLElement","contains","setComponentTemplate","TEMPLATE"],"mappings":"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"}