{"version":3,"file":"loading-scroll-view.js","sources":["../../src/components/loading-scroll-view.js"],"sourcesContent":["import ScrollView from './scroll-view.js';\n\nconst MAX_LOAD_MORE_FREQUENCY_MS = 1000;\n\nexport default class LoadingScrollView extends ScrollView {\n  _lastLoadMoreCheck = +new Date();\n\n  onScrollChange(scrollLeft, scrollTop) {\n    super.onScrollChange(scrollLeft, scrollTop);\n    if (\n      this.canLoadMore &&\n      +new Date() - this._lastLoadMoreCheck > MAX_LOAD_MORE_FREQUENCY_MS\n    ) {\n      this.conditionallyTriggerLoadMore();\n    }\n  }\n\n  onScrollingComplete() {\n    super.onScrollingComplete();\n    if (this.isDestroyed || this.isDestroying) {\n      return;\n    }\n    this.conditionallyTriggerLoadMore();\n  }\n\n  get extraCssClasses() {\n    return [super.extraCssClasses, 'LoadingScrollView']\n      .filter(Boolean)\n      .join(' ');\n  }\n\n  get canLoadMore() {\n    if (this.isDestroyed || this.isDestroying) {\n      return false;\n    }\n    return this.args.loadMore && this.args.hasMore && !this.args.isLoadingMore;\n  }\n\n  get threshold() {\n    return this.args.threshold || 350;\n  }\n\n  conditionallyTriggerLoadMore() {\n    this._lastLoadMoreCheck = +new Date();\n\n    if (!this.canLoadMore || !this._appliedContentHeight) {\n      return;\n    }\n\n    let scrollTop = this._appliedScrollTop;\n    let maxScrollTop = this._appliedContentHeight - this._appliedClientHeight;\n    let distanceFromBottom = maxScrollTop - scrollTop;\n    if (distanceFromBottom >= this.threshold) {\n      return;\n    }\n\n    let loadMoreResult = this.args.loadMore();\n    if (loadMoreResult && loadMoreResult.then) {\n      loadMoreResult.then(() => {\n        this.measureClientAndContent();\n      });\n    }\n  }\n}\n"],"names":["MAX_LOAD_MORE_FREQUENCY_MS","LoadingScrollView","ScrollView","_lastLoadMoreCheck","Date","onScrollChange","scrollLeft","scrollTop","canLoadMore","conditionallyTriggerLoadMore","onScrollingComplete","isDestroyed","isDestroying","extraCssClasses","filter","Boolean","join","args","loadMore","hasMore","isLoadingMore","threshold","_appliedContentHeight","_appliedScrollTop","maxScrollTop","_appliedClientHeight","distanceFromBottom","loadMoreResult","then","measureClientAndContent","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;AAEA,MAAMA,0BAA0B,GAAG,IAAI;AAExB,MAAMC,iBAAiB,SAASC,UAAU,CAAC;AACxDC,EAAAA,kBAAkB,GAAG,CAAC,IAAIC,IAAI,EAAE;AAEhCC,EAAAA,cAAcA,CAACC,UAAU,EAAEC,SAAS,EAAE;AACpC,IAAA,KAAK,CAACF,cAAc,CAACC,UAAU,EAAEC,SAAS,CAAC;AAC3C,IAAA,IACE,IAAI,CAACC,WAAW,IAChB,CAAC,IAAIJ,IAAI,EAAE,GAAG,IAAI,CAACD,kBAAkB,GAAGH,0BAA0B,EAClE;MACA,IAAI,CAACS,4BAA4B,EAAE;AACrC,IAAA;AACF,EAAA;AAEAC,EAAAA,mBAAmBA,GAAG;IACpB,KAAK,CAACA,mBAAmB,EAAE;AAC3B,IAAA,IAAI,IAAI,CAACC,WAAW,IAAI,IAAI,CAACC,YAAY,EAAE;AACzC,MAAA;AACF,IAAA;IACA,IAAI,CAACH,4BAA4B,EAAE;AACrC,EAAA;EAEA,IAAII,eAAeA,GAAG;AACpB,IAAA,OAAO,CAAC,KAAK,CAACA,eAAe,EAAE,mBAAmB,CAAC,CAChDC,MAAM,CAACC,OAAO,CAAC,CACfC,IAAI,CAAC,GAAG,CAAC;AACd,EAAA;EAEA,IAAIR,WAAWA,GAAG;AAChB,IAAA,IAAI,IAAI,CAACG,WAAW,IAAI,IAAI,CAACC,YAAY,EAAE;AACzC,MAAA,OAAO,KAAK;AACd,IAAA;AACA,IAAA,OAAO,IAAI,CAACK,IAAI,CAACC,QAAQ,IAAI,IAAI,CAACD,IAAI,CAACE,OAAO,IAAI,CAAC,IAAI,CAACF,IAAI,CAACG,aAAa;AAC5E,EAAA;EAEA,IAAIC,SAASA,GAAG;AACd,IAAA,OAAO,IAAI,CAACJ,IAAI,CAACI,SAAS,IAAI,GAAG;AACnC,EAAA;AAEAZ,EAAAA,4BAA4BA,GAAG;AAC7B,IAAA,IAAI,CAACN,kBAAkB,GAAG,CAAC,IAAIC,IAAI,EAAE;IAErC,IAAI,CAAC,IAAI,CAACI,WAAW,IAAI,CAAC,IAAI,CAACc,qBAAqB,EAAE;AACpD,MAAA;AACF,IAAA;AAEA,IAAA,IAAIf,SAAS,GAAG,IAAI,CAACgB,iBAAiB;IACtC,IAAIC,YAAY,GAAG,IAAI,CAACF,qBAAqB,GAAG,IAAI,CAACG,oBAAoB;AACzE,IAAA,IAAIC,kBAAkB,GAAGF,YAAY,GAAGjB,SAAS;AACjD,IAAA,IAAImB,kBAAkB,IAAI,IAAI,CAACL,SAAS,EAAE;AACxC,MAAA;AACF,IAAA;IAEA,IAAIM,cAAc,GAAG,IAAI,CAACV,IAAI,CAACC,QAAQ,EAAE;AACzC,IAAA,IAAIS,cAAc,IAAIA,cAAc,CAACC,IAAI,EAAE;MACzCD,cAAc,CAACC,IAAI,CAAC,MAAM;QACxB,IAAI,CAACC,uBAAuB,EAAE;AAChC,MAAA,CAAC,CAAC;AACJ,IAAA;AACF,EAAA;AACF;AAACC,oBAAA,CAAAC,QAAA,EA3DoB9B,iBAAiB,CAAA;;;;"}