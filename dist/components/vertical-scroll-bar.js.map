{"version":3,"file":"vertical-scroll-bar.js","sources":["../../src/components/vertical-scroll-bar.js"],"sourcesContent":["import Component from '@glimmer/component';\nconst MIN_THUMB_LENGTH = 15;\nimport { action } from '@ember/object';\n\nexport default class VerticalScrollBar extends Component {\n  _isScrolling = false;\n  _scrollTop = 0;\n\n  constructor() {\n    super(...arguments);\n    this.trackHeight = 0;\n    this.trackElement = null;\n  }\n\n  @action\n  didInsert(element) {\n    this.trackElement = element;\n    this.thumb = element.querySelector('[data-thumb]');\n    this.updateTrackHeight();\n    this.updateThumbStyle();\n    this.args.registerWithScrollView(this.updateScrollingParameters.bind(this));\n  }\n\n  @action\n  didUpdateScrollerHeight(element) {\n    if (this._lastScrollerHeight !== this.args.scrollerHeight) {\n      if (element) {\n        this.trackElement = element;\n        this.updateTrackHeight();\n        this.updateThumbStyle();\n      }\n      this._lastScrollerHeight = this.args.scrollerHeight;\n    }\n  }\n\n  updateScrollingParameters(isScrolling, scrollTop) {\n    this._scrollTop = scrollTop;\n    this._isScrolling = isScrolling;\n    this.updateThumbStyle();\n  }\n\n  updateThumbStyle() {\n    let { scrollerHeight } = this.args;\n    if (!scrollerHeight || !this.thumb) {\n      return;\n    }\n    let trackHeight = this.updateTrackHeight();\n    if (!trackHeight) {\n      return;\n    }\n    let { contentRatio, scrollTopRatio, _isScrolling } = this;\n    if (!_isScrolling) {\n      this.thumb.style.opacity = '0';\n      return;\n    }\n\n    let rawThumbHeight = contentRatio * trackHeight;\n    let thumbHeight = Math.max(MIN_THUMB_LENGTH, rawThumbHeight);\n    let trackAreaScrollSize = Math.max(0, trackHeight - thumbHeight);\n    let thumbY = scrollTopRatio * trackAreaScrollSize;\n    let isAtMax = thumbY + thumbHeight >= trackHeight;\n\n    if (isAtMax) {\n      thumbY = trackHeight - thumbHeight;\n    }\n\n    if (thumbY < 0) {\n      thumbY = 0;\n    }\n\n    Object.assign(this.thumb.style, {\n      opacity: '1',\n      height: `${thumbHeight}px`,\n      boxSizing: 'border-box',\n      transform: `translateY(${thumbY}px)`,\n    });\n  }\n\n  updateTrackHeight() {\n    if (!this.trackElement) {\n      return this.trackHeight;\n    }\n    this.trackHeight = Math.max(0, this.trackElement.offsetHeight);\n    return this.trackHeight;\n  }\n\n  get contentRatio() {\n    let ratioBeforeOverscrollAdjustment =\n      this.args.scrollerHeight / this.effectiveContentHeight;\n    return (\n      this.args.scrollerHeight /\n      (this.effectiveContentHeight +\n        this.overscrollAmount * (1 / ratioBeforeOverscrollAdjustment))\n    );\n  }\n\n  get effectiveContentHeight() {\n    return Math.max(this.args.scrollerHeight + 1, this.args.contentHeight);\n  }\n\n  get scrollTopRatio() {\n    return this._scrollTop / this.scrollAreaSize;\n  }\n\n  get overscrollAmount() {\n    let scrollTop = this._scrollTop;\n\n    if (scrollTop < 0) {\n      return -scrollTop;\n    } else if (scrollTop > this.scrollAreaSize) {\n      return scrollTop - this.scrollAreaSize;\n    }\n    return 0;\n  }\n\n  get scrollAreaSize() {\n    return this.effectiveContentHeight - this.args.scrollerHeight;\n  }\n}\n"],"names":["MIN_THUMB_LENGTH","VerticalScrollBar","Component","_isScrolling","_scrollTop","constructor","arguments","trackHeight","trackElement","didInsert","element","thumb","querySelector","updateTrackHeight","updateThumbStyle","args","registerWithScrollView","updateScrollingParameters","bind","n","prototype","action","didUpdateScrollerHeight","_lastScrollerHeight","scrollerHeight","isScrolling","scrollTop","contentRatio","scrollTopRatio","style","opacity","rawThumbHeight","thumbHeight","Math","max","trackAreaScrollSize","thumbY","isAtMax","Object","assign","height","boxSizing","transform","offsetHeight","ratioBeforeOverscrollAdjustment","effectiveContentHeight","overscrollAmount","contentHeight","scrollAreaSize","setComponentTemplate","TEMPLATE"],"mappings":"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"}