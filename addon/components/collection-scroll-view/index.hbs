<ScrollView
    class="CollectionScrollView"
    @contentHeight={{this.scrollHeight}}
    @scrollTopOffset={{@scrollTopOffset}}
    @initialScrollTop={{@initialScrollTop}}
    @key={{@key}}
    @auxiliaryComponent={{if @auxiliaryComponent
      (component @auxiliaryComponent
        cellLayout=this.cellLayout
        items=@items
        clientSize=this.collectionClientSize
        scrollTop=this.collectionScrollTop
        verticalOffset=this.visibleHeaderHeight
      )
    }}
    @clientSizeChange={{this.clientSizeChange}}
    @scrollChange={{this.scrollChange}}
    @scrolledToTopChange={{this.onScrolledToTopChange}}
    {{create-ref 'element'}}
    ...attributes
  as |scrollViewApi|
>

  {{#if (has-block 'header')}}
    <div {{on-resize (fn this.updateHeaderDimensions scrollViewApi)}}>
      {{yield to="header"}}
    </div>
  {{/if}}

  {{#if (not (and (has-block 'header') (is-empty this.headerDimensions)))}}
    <div
      data-test-collection-items-container
      role="list"
      style={{html-safe (concat "position:relative;height:" this.contentSize.height "px;width:" this.contentSize.width "px")}}
      {{did-update this.onItemsDidUpdate this.itemsLength}}
    >
      <CollectionScrollView::CollectionItems
        @clientSize={{this.collectionClientSize}}
        @scrollTop={{this.collectionScrollTop}}
        @estimatedSize={{hash width=@estimated-width height=@estimated-height}}
        @items={{@items}}
        @buffer={{@buffer}}
        @cellLayout={{this.cellLayout}}
        @onContentSizeUpdated={{this.updateContentSizeAfterRender}}
        as |cells|
      >
        {{~#each cells as |cell|~}}
          {{!-- template-lint-disable require-context-role --}}
          <div
            style={{html-safe cell.style}}
            role="listitem"
            tabindex={{if (eq cell.index this.activeCellIndex) "0" "-1"}}
            aria-posinset={{add cell.index 1}}
            aria-setsize={{this.itemsLength}}
            data-collection-scroll-view-cell-container-id={{cell.containerId}}
            data-collection-scroll-view-cell-index={{cell.index}}
            {{on "focusin" (fn this.handleCellFocus cell.index)}}
            {{on "keydown" (fn this.handleCellKeydown scrollViewApi cell.index)}}
          >{{yield cell.item cell.index scrollViewApi to="row"}}</div>
        {{~/each~}}
      </CollectionScrollView::CollectionItems>
    </div>
  {{/if}}

  {{#if @revealService}}
    {{emitter-action
      emitter=@revealService
      eventName="revealItemById"
      action=(fn this.scrollToItem scrollViewApi)
    }}
  {{/if}}
</ScrollView>
